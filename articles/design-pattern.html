<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Boxly Design Pattern • boxly</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="Boxly Design Pattern">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">boxly</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.1</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/boxly.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/boxly-cran.html">An Introduction to the boxly Package</a></li>
    <li><a class="dropdown-item" href="../articles/design-pattern.html">Boxly Design Pattern</a></li>
    <li><a class="dropdown-item" href="../articles/hover-label.html">Customize Hover Labels in Interactive Box Plot</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/Merck/boxly/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Boxly Design Pattern</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/Merck/boxly/blob/main/vignettes/design-pattern.Rmd" class="external-link"><code>vignettes/design-pattern.Rmd</code></a></small>
      <div class="d-none name"><code>design-pattern.Rmd</code></div>
    </div>

    
    
<blockquote>
<p>This document is for developers who would like to understand the
internals of the boxly package.</p>
</blockquote>
<div class="section level2">
<h2 id="overview">Overview<a class="anchor" aria-label="anchor" href="#overview"></a>
</h2>
<p>The boxly package is developed to generate interactive box plot for
the safety analysis in clinical trials.</p>
<p>To generate an interactive box plot, we develop two main functions as
listed below. And the details of these two main functions will be
introduced in the next sections separately.</p>
<ul>
<li>
<code><a href="../reference/prepare_boxly.html">prepare_boxly()</a></code>: Obtain information such as lab and
vital sign ready for visualization.</li>
<li>
<code><a href="../reference/boxly.html">boxly()</a></code>: Generate an interactive box plot.</li>
</ul>
<p>A minimal example summarizing the major steps in using the forestly
package is</p>
<pre><code><span><span class="va">outdata</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/prepare_boxly.html">prepare_boxly</a></span><span class="op">(</span><span class="va">...</span><span class="op">)</span>    <span class="co"># Step 1: create a list object include data required for plotting</span></span>
<span><span class="fu"><a href="../reference/boxly.html">boxly</a></span><span class="op">(</span><span class="va">outdata</span><span class="op">)</span>                   <span class="co"># Step 2: generate interactive box plot</span></span></code></pre>
</div>
<div class="section level2">
<h2 id="interactive-features">Interactive features<a class="anchor" aria-label="anchor" href="#interactive-features"></a>
</h2>
<p>As an interactive visualization tool, boxly contains several
interactive features:</p>
<ul>
<li><p>Hover label of outlier will show participant ID, change from
baseline value and baseline value.</p></li>
<li><p>Hover label of box will number of subject and summary statistics
such as number of participant, minimum, Q1, mean, median, Q3, maximum,
standard deviation.</p></li>
<li><p>Select box to select parameter (Need POC)</p></li>
<li><p>Slider bar to control cut off value of number of subject (Need
POC)</p></li>
<li><p>Append summary table under the box plot</p></li>
</ul>
</div>
<div class="section level2">
<h2 id="input-data-structure-and-attributes">Input data structure and attributes<a class="anchor" aria-label="anchor" href="#input-data-structure-and-attributes"></a>
</h2>
<p>Metadata which is generated by metalite package is required as input.
<code><a href="../reference/meta_boxly.html">meta_boxly()</a></code> is generated in the boxly package for
illustration purpose. Users should create metadata with similar
structure.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://merck.github.io/boxly/">boxly</a></span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">meta</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/meta_boxly.html">meta_boxly</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">meta</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="main-function-1-prepare_boxly">Main function 1: <code>prepare_boxly()</code><a class="anchor" aria-label="anchor" href="#main-function-1-prepare_boxly"></a>
</h2>
<p>The main function <code><a href="../reference/prepare_boxly.html">prepare_boxly()</a></code> is used to obtain tidy
up data for visualization. The output for this function would be a
<code>list</code> object contains meta data information, variable names
used for plotting such as x, y, group by and parameter variable and data
frame for plotting. x, y, group by and parameter variable are four main
variables we required for generate our interactive box plot. These
variable names could be extracted from input meta data by using
<code><a href="https://merck.github.io/metalite/reference/collect_adam_mapping.html" class="external-link">metalite::collect_adam_mapping()</a></code>. x, group by and parameter
variable should be factor data type. y variable should be numeric data
type. We check the data type of these variables and convert it into data
type we need in <code><a href="../reference/prepare_boxly.html">prepare_boxly()</a></code>. x, y, group by and
parameter variable name could be saved in returned list of
<code><a href="../reference/prepare_boxly.html">prepare_boxly()</a></code> in element <code>x_var</code>,
<code>y_var</code>, <code>group_var</code> and <code>param_var</code>
accordingly.</p>
<p>Also, the plotting dataset would be generated in this function. The
plotting dataset includes statistical variables for count, quantile,
mean, median, min, max, standard deviation and outlier value which are
calculated in this function. (stand deviation part is not developed
currently) Other variables used for hover label such as participant ID
and baseline variable are also include. (Baseline variable is not
included now)</p>
<p>Here is the structure for the expected output list of
<code><a href="../reference/prepare_boxly.html">prepare_boxly()</a></code>:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">outdata</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/prepare_boxly.html">prepare_boxly</a></span><span class="op">(</span><span class="va">meta</span>,</span>
<span>  population <span class="op">=</span> <span class="st">"apat"</span>,</span>
<span>  observation <span class="op">=</span> <span class="st">"wk12"</span>,</span>
<span>  parameter <span class="op">=</span> <span class="st">"sodium;bili;urate"</span>,</span>
<span>  analysis <span class="op">=</span> <span class="st">"lb_boxly"</span></span>
<span><span class="op">)</span></span>
<span><span class="va">outdata</span></span></code></pre></div>
<p>Here is the example for the plotting dataset should be contained in
output <code>list</code>:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">outdata</span><span class="op">$</span><span class="va">plotds</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="main-function-2-boxly">Main function 2: <code>boxly()</code><a class="anchor" aria-label="anchor" href="#main-function-2-boxly"></a>
</h2>
<p>This function generates an interactive box plot for the returned
object of <code><a href="../reference/prepare_boxly.html">prepare_boxly()</a></code>. For this interactive box plot,
it consists two blocks.</p>
<p>The first block is a select list and slider bar. Items listed in the
select list is specified by the unique value of parameter variable
contained in returned object of <code><a href="../reference/prepare_boxly.html">prepare_boxly()</a></code>. By
clicking different parameter label, different interactive boxplot would
display. For example, if you click “Alkaline Phosphatase (U/L)”, then
the reactable will only display interactive box plot for
<code>Alkaline Phosphatase (U/L)</code>. The main tool to develop this
block is <code><a href="https://rdrr.io/pkg/crosstalk/man/filter_select.html" class="external-link">crosstalk::filter_select()</a></code>. For slider bar, it
should control the cut off number byy slide the slider bar. For example,
only if participant number of a treatment group in that time point is
larger than 5 a box will be shown. The main tool to develop this block
is <code><a href="https://rdrr.io/pkg/crosstalk/man/filter_slider.html" class="external-link">crosstalk::filter_slider()</a></code>. (This part is under
development)</p>
<p>The second block is an combined interactive visualization tool which
contains a box plot display and interactive table appended for number of
participant. For the box plot is mainly developed by the plotly package
and the table is developed using the DT package. We generate static
scatter plot for outliers specifically through ggplot2 and convert it
into interactive plot by using <code><a href="https://rdrr.io/pkg/plotly/man/ggplotly.html" class="external-link">plotly::ggplotly()</a></code>. Then we
add box plot layer and invisible bar plot layer using
<code><a href="https://rdrr.io/pkg/plotly/man/add_trace.html" class="external-link">plotly::add_trace()</a></code>. The reason why we need to create
outlier and box separately is that plotly does not support different
hover label for box and outlier. Appended table was generated using
<code><a href="https://rdrr.io/pkg/DT/man/datatable.html" class="external-link">DT::datatable()</a></code>. <code><a href="https://rstudio.github.io/htmltools/reference/builder.html" class="external-link">htmltools::div()</a></code> is used to
combine these two components now. Hover label should be display properly
in this part as we mentioned in Interactive Feature part above.</p>
<blockquote>
<p>Argument list</p>
</blockquote>
<table class="table">
<colgroup>
<col width="23%">
<col width="16%">
<col width="17%">
<col width="17%">
<col width="15%">
<col width="9%">
</colgroup>
<thead><tr class="header">
<th>Argument</th>
<th align="center">Description</th>
<th align="right">Default Value</th>
<th align="center">Required (Y/N)</th>
<th align="center">Valid Values</th>
<th align="center">Comments</th>
</tr></thead>
<tbody>
<tr class="odd">
<td><code>outdata</code></td>
<td align="center">List object from <code><a href="../reference/prepare_boxly.html">prepare_boxly()</a></code>
</td>
<td align="right"></td>
<td align="center">Y</td>
<td align="center"></td>
<td align="center"></td>
</tr>
<tr class="even">
<td><code>color</code></td>
<td align="center">Vector of color defined for box plot</td>
<td align="right"></td>
<td align="center">N</td>
<td align="center"></td>
<td align="center"></td>
</tr>
<tr class="odd">
<td><code>x_label</code></td>
<td align="center">x-axis label</td>
<td align="right"></td>
<td align="center">N</td>
<td align="center"></td>
<td align="center"></td>
</tr>
<tr class="even">
<td><code>y_label</code></td>
<td align="center">y-axis label</td>
<td align="right"></td>
<td align="center">N</td>
<td align="center"></td>
<td align="center"></td>
</tr>
<tr class="odd">
<td><code>vline</code></td>
<td align="center"></td>
<td align="right"></td>
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
</tr>
<tr class="even">
<td><code>vline_label</code></td>
<td align="center"></td>
<td align="right"></td>
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
</tr>
<tr class="odd">
<td><code>header_summary_table</code></td>
<td align="center"></td>
<td align="right"></td>
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
</tr>
<tr class="even">
<td><code>header_select_list</code></td>
<td align="center"></td>
<td align="right"></td>
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
</tr>
<tr class="odd">
<td><code>header_slider_bar</code></td>
<td align="center"></td>
<td align="right"></td>
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
</tr>
</tbody>
</table>
<blockquote>
<p>Here is the minimum viable production. The layout and labels are just
for illustration now.</p>
</blockquote>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">p_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/prepare_boxly.html">prepare_boxly</a></span><span class="op">(</span><span class="va">meta</span>,</span>
<span>  population <span class="op">=</span> <span class="st">"apat"</span>,</span>
<span>  observation <span class="op">=</span> <span class="st">"wk12"</span>,</span>
<span>  parameter <span class="op">=</span> <span class="st">"sodium;bili;urate"</span>,</span>
<span>  analysis <span class="op">=</span> <span class="st">"lb_boxly"</span></span>
<span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/boxly.html">boxly</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">p_list</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="todo">TODO<a class="anchor" aria-label="anchor" href="#todo"></a>
</h2>
<ul>
<li>Refine the plot layout and column label.</li>
<li>Add select list and slider bar.</li>
<li>Fulfill all the requirements for hover label and format the
calculated statistical value.</li>
<li>Bug: outliers are not display well. It seems a issue from ggplot2
which <code>geom_point()</code> will generate different display between
having <code>aes(..., text = )</code> and <code>aes(...)</code> in our
scenario.</li>
</ul>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Benjamin Wang, Yujie Zhao. Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0. <br>Copyright © 2023 Merck &amp; Co., Inc., Rahway, NJ, USA and its affiliates. All rights reserved.</p>
</div>

<div class="pkgdown-footer-right">
  <p><span></span></p>
</div>

    </footer>
</div>





  </body>
</html>
